1. Клонируем [репозиторий](https://github.com/afterlogic/aurora-mail-app-flutter)
2. Устанавливаем [Xcode](https://apps.apple.com/ru/app/xcode/id497799835?l=en&mt=12)
3. Устанавливаем [Android Studio](https://developer.android.com/studio)
4. Устанавливаем Flutter согласно [инструкции](https://flutter.dev/docs/get-started/install)

5. В случае необходимости включения PGP функционала требуется установить следующий инструментарий
Java > ObjectiveC
Нужно скачать [j2objc](https://github.com/google/j2objc/releases/download/2.7/j2objc-2.7.zip),
Распаковать в папку ios и переименовать распакованную папку в dist

6. Основой для сборки любой версии в том числе и кастомной является набор конфирурационных файлов и изображений.
Набор ресурсов для сборки регулярной версии находится  в папке  build_res. Так же там есть шаблон для создания кастомной сборки.
Для создания кастомной сборки нужно копировать папку template из каталога build_res и переименовать в любое произвольное значение, она содержит необходимые ресурсы для приложения

7. Для сборки iOS приложения:
В своем аккаунте на Apple создать id для AppGroup, выбрав тип ```App Groups``` при создании id. 
Сделать это можно [тут](https://developer.apple.com/account/resources/identifiers/list)

Так же нужно создать id приложения и id для модуля AppShareExtension, который состоит из id вашего приложения + ".AppShareExtension".
например id = ```my.app.id``` id AppShareExtension = ```my.app.id.AppShareExtension```
И включить ```App Groups``` у обоих id, выбрав ранее созданную группу

После указать данные id приложения и id созданной группы в соответсвующих полях файла ```build_variant.yaml```
id AppShareExtension указывать не нужно
Так же требуется указать Team ID. 
Его можно посмотреть [тут](https://developer.apple.com/account/#/membership)

8. Для сборки Android приложения:
Необходимо указать id приложения, например ```my.app.id``` в файле ```build_variant.yaml```

9. В проекте используется сервис Firebase для сбора аналитики. Для сборки приложения потребует создать проект на Firebase. Сделать это можно тут _LINK_.
В проекте требуется создать 2 приложения: для iOS и Android версий. 
В переименованной папке с шаблоном приложения нужно создать папку crashlytics  и поместить в нее 2 файла:  ```GoogleService-Info.plist```  и ```google-services.json``` из соответствующих приложений firebase проекта.

10. Для подписывания приложения потребуются создать [ключ подписывания](https://developer.android.com/studio/publish/app-signing#generate-key). 
Полученный файл ```key.jks```, который содержит ключ для подписи приложения, нужно положить в папку sign.
Нужно отредактировать и заполнить поля в файле  ```key_template.properties```. Затем переименовываем файл в  ```key.properties```. 

11. Изменить тему и обновить файлы изображений.
Картинки находятся в подпапке image
Все картинки должны имееть размер 512х512 или 1024х1024

```icon.png``` иконка используемая на рабочем столе. Не должна иметь альфа канал. 
```icon_foreground.png``` иконка с прозрачным фоном используемая для физической иконки в некоторых версиях Android. 
```main_logo.png``` иконка в приложении на экране логина и в about из настроек

Требуемую цветовую схему можно описать в файле theme/lib/app_color.dart

12. Для переключения на сборку нужно выполнить ```sh/build_variant.sh <путь>``` 
где в переменной ```путь``` находится путь до  файла ```build_variant.yaml``` в папке с ресурсами кастомной версии

13. Для создания сертификатов для подмисывания iOS версии приложения требуется открыть проект в XCode.
Кликнуть на корневой проект Runner в структуре проекта, в открывшемся окне в списке Targets выбрать Runner и выбрать пункт Signing & Capabilities.
Сертификаты должны быть созданы автоматически

14. Для сборки Android весрии
выполняем ```build_android.sh```
собранные пакеты появятся в каталоге ```build```

15. Для сборки iOS
выполнить ```sh/build_ios.sh``` 
собранные пакеты появятся в каталоге ```build```
Собранный пакет можно залить в TestFlight с помощью приложения [Transporter](https://apps.apple.com/ru/app/transporter/id1450874784?l=en&mt=12)

В приложении можно включить и отключить определенный функционал указав true либо false в поле с соответсвующем флагом в файле ```build_variant.yaml```
Флаги сборки
multiUserEnable - возможность добавлять и переключать почтовых пользователей 
multiAccountEnable - возможность переключать почтовые аккаунты у пользователя
cryptoEnable - pgp шифрование писем
useMainLogo - использование ```main_logo.png``` на экране логина
selfDestructingEmail - Возможность отправки писем, которые будут недоступны через заданный промежутов времени
expandMessageThread - Возможность открытие трэда писем по клику на количество писем в треде на экране списка писем
logger - функционал логирования работы приложения 
pushNotification - оповещение о новых письмах с помощью push нотификаций  
